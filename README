# README

## Build and test 

### Build
docker build -t frankang/twitter-feed .

### Local test on laptop with creds. pass --env option to docker run. 

docker run -e AWS_ACCESS_KEY_ID=xyz -e AWS_SECRET_ACCESS_KEY=aaa AWS_DEFAULT_REGION="ap-southeast-1" -t frankang/twitter-sfeed

### Local docker testing with an environment file that defines AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_DEFAULT_REGION
docker run --env-file ~/.aws/docker_credentials -t frankang/twitter-feed

## Test API GW endpoint 

### Send test POST to API GW

curl -vv -H "Content-Type: application/json" -X POST -d '{ "text": "the xphone is a decent product #xoyxoz" }' https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed

curl -vv -H "Content-Type: application/json" -X POST -d '{ "text": "This day I have to start working to reduce weight and pay attention to healthy eating. 2016 Ford Mustang Ecoboost Coupe." }' https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed

curl -vv -H "Content-Type: application/json" -X POST -d '{ "text": "这天是我必须开始运通减胖以及注意健康饮食。2016 Ford Mustang Ecoboost Coupe." }' https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed

curl -vv -H "Content-Type: application/json" -X POST -d '{ "text": "foobar #xoyxoz" }' https://api.demolab.host/test/feed


### Send test GET to API GW
curl -vv  -X GET https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed

curl -vv -X GET -H 'api.demolab.host' https://api.demolab.host/test/feed

curl -vv -X GET -H 'api.demolab.host' https://api.demolab.host/test/feed

### Authenticate Requests
...403 problem
MissingAuthenticationTokenException

curl -vv  -X GET https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed


#### Setup custom domain:
Note: be careful different: AWS-managed Hosted Zone (in JSON payload), and my own hosted zone (on CLI param)
aws route53 change-resource-record-sets --hosted-zone-id  Z3EHXY9C7Z07GG --change-batch file:///Users/frankang/lab/Feeds/twitter-feed/setup-dns-record.json 



awscurl --service execute-api -X POST -d '{ "text": "foobar #xoyxoz" }'  \
  https://56vwcxeu8c.execute-api.ap-southeast-1.amazonaws.com/test/feed

awscurl --service execute-api -X POST -d '{ "text": "foobar #xoyxoz" }' \
 --region ap-southeast-1 https://api.demolab.host/feed/test/feed

 awscurl --service execute-api -X POST -d '{ "text": "foobar #xoyxoz" }' \
 --region ap-southeast-1 https://api.demolab.host/feed/feed


 awscurl --service execute-api -X GET --region ap-southeast-1 https://api.demolab.host/feed/feed


 ### TODO publish messages to slack

 curl -X POST -H 'Content-type: application/json' --data '{"text":"Hello, World!"}' https://hooks.slack.com/services/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
 